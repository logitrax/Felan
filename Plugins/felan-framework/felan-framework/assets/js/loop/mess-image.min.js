(function(l){"use strict";var t=felan_mess_image_vars.ajax_url,_=felan_mess_image_vars.mess_image_title,m=felan_mess_image_vars.mess_image_type,r=felan_mess_image_vars.mess_image_file_size,c=felan_mess_image_vars.mess_image_id,f=felan_mess_image_vars.mess_image_upload_nonce;jQuery(document).ready(function(){var e=l(".felan-fields-mess_image");l.each(e,function(){var e=function(){var s=new plupload.Uploader({browse_button:"felan_select_mess_image_"+c,file_data_name:"felan_mess_image_upload_file_"+c,drop_element:"felan_mess_image_view_"+c,container:"felan_mess_image_container_"+c,url:t+"?action=felan_mess_image_upload_ajax&nonce="+f+"&mess_image_id="+c,filters:{mime_types:[{title:_,extensions:m}],max_file_size:r,prevent_duplicates:true}});s.init();s.bind("UploadProgress",function(e,a){document.getElementById("felan_select_mess_image_"+c).innerHTML='<span><i class="fal fa-spinner fa-spin large"></i></span>'});s.bind("FilesAdded",function(e,a){e.refresh();s.start()});s.bind("Error",function(e,a){alert("Error #"+a.code+": "+a.message)});var e=l("#mess_image_id_"+c).val();var a=l("#mess_image_url_"+c).val();if(e&&a){var i='<figure class="media-thumb media-thumb-wrap">'+'<img src="'+a+'">'+'<div class="media-item-actions">'+'<a class="icon icon-mess_image-delete_'+c+'" data-attachment-id="'+e+'" href="#" ><i class="far fa-trash-alt large"></i></a>'+'<span style="display: none;" class="icon icon-loader"><i class="fal fa-spinner fa-spin large"></i></span>'+"</div>"+"</figure>";l("#felan_mess_image_view_"+c).html(i);l("#felan_add_mess_image_"+c).hide()}s.bind("FileUploaded",function(e,a,s){document.getElementById("felan_drop_mess_image_"+c).innerHTML='<button type="button" class="tooltip" id="felan_select_mess_image_'+c+'" data-title="Upload Image"><i class="far fa-images"></i></button>';var i=l.parseJSON(s.response);if(i.success){l("#mess_image_url_"+c).val(i.full_image);l("#mess_image_id_"+c).val(i.attachment_id);var _='<figure class="media-thumb media-thumb-wrap">'+'<img src="'+i.full_image+'">'+'<div class="media-item-actions">'+'<a class="icon icon-mess_image-delete_'+c+'" data-attachment-id="'+i.attachment_id+'" href="#" ><i class="far fa-trash-alt large"></i></a>'+'<span style="display: none;" class="icon icon-loader"><i class="fal fa-spinner fa-spin large"></i></span>'+"</div>"+"</figure>";l("#felan_mess_image_view_"+c).html(_);n();l("#mess_image_url-error_"+c).hide()}})};e();var n=function(m){l("body").on("click",".icon-mess_image-delete_"+c,function(e){e.preventDefault();var a=l(this),s=a,i=a.closest("#felan_mess_image_view_"+c).find(".media-thumb-wrap"),_=a.data("attachment-id"),n=l("#felan_drop_mess_image_"+c);s.html('<i class="fal fa-spinner fa-spin large"></i>');l.ajax({type:"post",url:t,dataType:"json",data:{action:"felan_mess_image_remove_ajax",attachment_id:_,type:m,removeNonce:f},success:function(e){if(e.success){i.remove();i.hide();l("#mess_image_url-error_"+c).show();l("#felan_add_mess_image_"+c).show()}s.html('<i class="fal fa-spinner fa-spin large"></i>');n.css("display","block");l("input#mess_image_url_"+c).val("");l("input#mess_image_id_"+c).val("")},error:function(){s.html('<i class="far fa-trash-alt large"></i>')}})})};n()})})})(jQuery);