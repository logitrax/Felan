var FELAN_STRIPE=FELAN_STRIPE||{};(function(u){"use strict";FELAN_STRIPE={setupForm:function(){var e=this,n=u(".felan-wallet-stripe-form");if(n.length===0)return;var a=n.attr("id");var t=felan_stripe_vars[a];var l=null;var r=n.find(".felan-stripe-button");if(r.length){l=StripeCheckout.configure({key:t.key,locale:"auto",token:function(e,a){u("<input>").attr({type:"hidden",name:"stripeToken",value:e.id}).appendTo(n);u("<input>").attr({type:"hidden",name:"stripeTokenType",value:e.type}).appendTo(n);if(e.email){u("<input>").attr({type:"hidden",name:"stripeEmail",value:e.email}).appendTo(n)}n.submit()}});r.on("click",function(e){e.preventDefault();l.open(t.params)})}window.addEventListener("popstate",function(){if(l!=null){l.close()}})}};u(document).ready(function(){const a=u(".felan-wallet-topup");let e=a.find(".payment-inner .title:first");e.addClass("active");a.find('input[name="payment_method"]').val(e.data("payment"));a.find(".payment-inner .title").on("click",function(){let e=u(this).data("payment");a.find(".payment-inner .title").removeClass("active");u(this).addClass("active");a.find('input[name="payment_method"]').val(e)});if(typeof felan_payment_vars!=="undefined"){var r=felan_template_vars.ajax_url;u(document).on("click","#felan_payment_wallet",function(){var e=u(".felan-wallet-topup");var a=e.find("input[name='payment_method']").val();var n=e.find("input[name='wallet_price']").val();var t=e.find("input[name='user_role']").val();var l=u("#felan_wallet_security_payment").val();if(a=="paypal"){s(t,n,l)}else if(a=="stripe"){i(t,n,l)}else if(a=="wire_transfer"){f(t,n,l)}else if(a=="woocheckout"){o(t,n,l)}else if(a=="razor"){d(t,n,l)}});var i=function(e,a,n){var t=u(".felan-wallet-stripe-form");var l=u("#form-wallet-topup");l.find(".felan-message-error").text("");u.ajax({type:"POST",url:r,data:{action:"felan_stripe_payment_wallet_addons",user_role:e,wallet_price:a,felan_wallet_security_payment:n},beforeSend:function(){u("#felan_payment_wallet").append('<div class="felan-loading-effect"><span class="felan-dual-ring"></span></div>')},success:function(e){if(e.success&&e.data.script){u("body").append(e.data.script);FELAN_STRIPE.setupForm();u("#felan_stripe_wallet_addons button").trigger("click");t.find('input[name="stripe_wallet_price"]').val(e.data.wallet_price);t.find('input[name="stripe_user_role"]').val(e.data.user_role);l.css({opacity:"0",visibility:"hidden"})}else{l.find(".felan-message-error").text(e.message)}u("#felan_payment_wallet .felan-loading-effect").remove()}})};var s=function(e,a,n){u("#form-wallet-topup").find(".felan-message-error").text("");u.ajax({type:"POST",url:r,data:{action:"felan_paypal_payment_wallet_addons",user_role:e,wallet_price:a,felan_wallet_security_payment:n},beforeSend:function(){u("#felan_payment_wallet").append('<div class="felan-loading-effect"><span class="felan-dual-ring"></span></div>')},success:function(e){if(e.success){window.location.href=e.redirect_url}else{u("#form-wallet-topup").find(".felan-message-error").text(e.message)}u("#felan_payment_wallet").find(".felan-loading-effect").remove()}})};var f=function(e,a,n){u("#form-wallet-topup").find(".felan-message-error").text("");u.ajax({type:"POST",url:r,data:{action:"felan_wire_transfer_wallet_addons",user_role:e,wallet_price:a,felan_wallet_security_payment:n},beforeSend:function(){u("#felan_payment_wallet").append('<div class="felan-loading-effect"><span class="felan-dual-ring"></span></div>')},success:function(e){if(e.success){window.location.href=e.redirect_url}else{u("#form-wallet-topup").find(".felan-message-error").text(e.message)}u("#felan_payment_wallet").find(".felan-loading-effect").remove()}})};var o=function(e,a,n){u("#form-wallet-topup").find(".felan-message-error").text("");u.ajax({type:"POST",url:r,data:{action:"felan_woocommerce_payment_wallet_addons",user_role:e,wallet_price:a,felan_wallet_security_payment:n},beforeSend:function(){u("#felan_payment_wallet").append('<div class="felan-loading-effect"><span class="felan-dual-ring"></span></div>')},success:function(e){if(e.success){window.location.href=e.redirect_url}else{u("#form-wallet-topup").find(".felan-message-error").text(e.message)}u("#felan_payment_wallet").find(".felan-loading-effect").remove()}})};var p=function(e,a){if(typeof a==="undefined"){a=true}var n=document.getElementById(e);if(a===false){n.removeAttribute("disabled")}else{n.setAttribute("disabled",a)}};function d(t,e,a){var l=u("#form-wallet-topup");l.find(".felan-message-error").text("");u.ajax({type:"POST",url:r,data:{action:"felan_razor_wallet_create_order",user_role:t,wallet_price:e,felan_wallet_security_payment:a},beforeSend:function(){u("#felan_payment_wallet").append('<div class="felan-loading-effect"><span class="felan-dual-ring"></span></div>')},success:function(n){console.log(n.data);if(n.success){n=n.data;n.modal={ondismiss:function(){p("felan_payment_wallet",false)}};n.handler=function(e){console.log("payment",e);document.getElementById("razorpay_payment_id").value=e.razorpay_payment_id;document.getElementById("razorpay_signature").value=e.razorpay_signature;var a=u("#felan_razor_paymentform").serializeArray();u.ajax({url:r,data:{action:"felan_razor_wallet_verify",razorpay_payment_id:u("#razorpay_payment_id").val(),razorpay_order_id:n.order_id,razorpay_signature:u("#razorpay_signature").val(),user_role:t},type:"POST",success:function(e){if(e){window.location.href=e}}})};c(n);l.css({opacity:"0",visibility:"hidden"})}else{l.find(".felan-message-error").text(n.message)}u("#felan_payment_wallet .felan-loading-effect").remove()}})}function c(e){var a=new Razorpay(e);a.open()}}})})(jQuery);